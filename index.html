<script>
// Mascots + NEONA & SMYLE + LOOKKHUNNOO, LYKUYOU
const mascotsGMMTV = [
  "KINGMAN","BABII","POLCASAN","MR. SATURNWORLD","PAODY","TOMAFOX","JAIDEE",
  "AVOCEAN","SAMRUAY","DOMIIA","JUMMO","GUINZLY","CERI","MUVMUV","LUNAR","ANY",
  "NILKHNAKE","SHYLE","NONGNOOONG","LYKOU","ANGELO","WESLEY","META","PERMPOON",
  "NEONA","SMYLE","LOOKKHUNNOO","LYKUYOU"
];

// เฉพาะ “คู่” (BL/GL/Side)
const coupleNames = [
  "OFFGUN", "TAYNEW", "BRIGHTWIN", "EARTHMIX", "PONDPHUWIN", "OHMNANON",
  "FORCEBOOK", "JOONGDUNK", "JIMMYSEA", "FIRSTKHAOTUNG", "GEMINIFOURTH",
  "WINNYSATANG", "GREATINN", "SEAKEEN", "PERTHSANTA", "WILLIAMEST", "JUNIORMARK",
  "JOSSGAWIN", "MARKOHM", "AOUBOOM", "SURFJAVA", "LUKEMICK", "CHOKUNASTON",
  "MILKLOVE", "EMIBONNIE", "NAMTANFILM", "VIEWMIM", "JUNEMEWNICH",
  "JAMIEEARN", "KENPAUL", "PODPAPANG", "ALMONDPROGRESS", 
  "LOOKKHUNNOO", "LYKUYOU"
];

const boxOptions = ["BOX A", "BOX B"];

// ใช้ราคาตามโปสเตอร์ (ลด 40%)
const PRODUCTS = [
  {id:"that_summer",title:"That Summer (นิยาย)",price:270,image:"images/that_summer.jpg"},
  {id:"burnout",title:"Burnout Syndrome (นิยาย)",price:270,image:"images/burnout.jpg"},
  {id:"last_twilight",title:"Last Twilight (นิยาย)",price:270,image:"images/last_twilight.jpg"},
  {id:"thamepo",title:"Thamepo (Heart That Skips a Beat Novel)",price:240,image:"images/thamepo.jpg"},
  {id:"ceri_doll_keychain",title:"Ceri Doll Keychain",price:420,image:"images/ceri_doll_keychain.jpg"},
  {id:"nilkhnake_doll_keychain",title:"Nilkhnake Doll Keychain",price:420,image:"images/nilkhnake_doll_keychain.jpg"},
  {id:"collectible_card_set_almondprogress",title:"Collectible Card Set (ALMONDPROGRESS)",price:210,image:"images/card_almondprogress.jpg"},
  {id:"collectible_card_set_viewmim",title:"Collectible Card Set (VIEWMIM)",price:210,image:"images/card_viewmim.jpg"},
  {id:"collectible_card_set_junemewnich",title:"Collectible Card Set (JUNEMEWNICH)",price:210,image:"images/card_junemewnich.jpg"},
  {id:"acrylic_keychain",title:"Customizable Acrylic Keychain",price:210,image:"images/acrylic_keychai.jpg",select:mascotsGMMTV},
  {id:"phone_grippy",title:"Fandom Phone Grippy (Random)",price:175,image:"images/phone_grippy.jpg",select:boxOptions},
  {id:"magsafe_wallet_stand",title:"MagSafe Wallet Stand",price:295,image:"images/magsafe_wallet.jpg",select:mascotsGMMTV},
  {id:"sticker_set",title:"Sticker Set",price:133,image:"images/sticker_set.jpg",select:mascotsGMMTV},
  {id:"hair_band",title:"Hair Band",price:295,image:"images/hair_band.jpg",select:mascotsGMMTV},
  {id:"huggy_bag",title:"Huggy Bag",price:355,image:"images/huggy_bag.jpg",select:mascotsGMMTV},
  {id:"sticky_fabric",title:"Sticky Fabric",price:235,image:"images/sticky_fabric.jpg",select:mascotsGMMTV},
  {id:"clear_pouch",title:"Clear Pouch",price:210,image:"images/clear_pouch.jpg",select:mascotsGMMTV},
  {id:"charm_illusion_tote",title:"Fandom Character Charm Illusion Tote Bag",price:535,image:"images/charm_illusion_tote.jpg"},
  {id:"patchy_illusion_tote",title:"Fandom Character Patchy Illusion Tote Bag",price:535,image:"images/patchy_illusion_tote.jpg"},
  {id:"collectible_card_album",title:"Collectible Card Album",price:180,image:"images/card_album.jpg",select:coupleNames}
];

let cart = [];
let shippingType = "";
let nadrubDate = "";
function renderProducts(){
  const container = document.getElementById('products');
  container.innerHTML = '';
  PRODUCTS.forEach(prod => {
    let prodSelect = '';
    if(prod.select){
      prodSelect = `
        <select id="select_${prod.id}" style="margin-top:10px;width:95%;">
          <option value="">${prod.select===boxOptions ? 'เลือก BOX A หรือ BOX B' : 'เลือกชื่อ'}</option>
          ${prod.select.map(a=>`<option value="${a}">${a}</option>`).join("")}
        </select>
      `;
    }
    container.innerHTML += `
      <div class="product-card">
        <img src="${prod.image}" alt="${prod.title}">
        <div class="prod-title">${prod.title}</div>
        <div class="prod-price">${prod.price}฿</div>
        ${prodSelect || ""}
        <button class="btn-add" onclick="addToCart('${prod.id}')">เพิ่ม</button>
      </div>
    `;
  });
}
window.onload = renderProducts;

function addToCart(pid){
  const prod = PRODUCTS.find(x=>x.id===pid);
  let selectVal = "";
  if(prod.select){
    selectVal = document.getElementById(`select_${pid}`).value;
    if(!selectVal){ alert(prod.select===boxOptions ? "กรุณาเลือก BOX" : "กรุณาเลือกชื่อในรายการ"); return;}
  }
  const same = cart.find(x=>x.id===pid && x.option===selectVal);
  if(same){
    same.qty += 1;
  }else{
    cart.push({id:pid, name:prod.title, price:prod.price, option:selectVal, qty:1});
  }
  renderCart();
}

function renderCart(){
  const cartList = document.getElementById("cartList");
  const cartSection = document.getElementById("cartSection");
  const paySection = document.getElementById("paySection");
  const formSection = document.getElementById("formSection");
  const shippingSelect = document.getElementById("shippingSelect");
  cartSection.style.display = cart.length ? "" : "none";
  paySection.style.display = cart.length ? "" : "none";
  formSection.style.display = cart.length ? "" : "none";
  shippingSelect.style.display = cart.length ? "" : "none";
  if(!cart.length) return;
  cartList.innerHTML = '';
  let sum = 0;
  cart.forEach((item,i)=>{
    sum += item.price * item.qty;
    cartList.innerHTML += `
      <div class="cart-item">
        ${item.name}${item.option?` <span style="color:#7b36c2;">(${item.option})</span>`:""} 
        &nbsp; x <input type="number" min="1" max="99" value="${item.qty}" style="width:40px" onchange="updateQty(${i},this.value)">
        <span style="color:#b84dc9;font-weight:bold;">= ${item.price*item.qty}฿</span>
        <button class="btn-remove" onclick="removeCart(${i})">ลบ</button>
      </div>
    `;
  });

  // Shipping option
  let shipText = '';
  let shippingFee = 0;
  if(shippingType === "post"){
    shipText = "วิธีรับสินค้า: ไปรษณีย์ (+40฿)";
    shippingFee = 40;
  } else if(shippingType === "nadrub" && nadrubDate){
    shipText = `วิธีรับสินค้า: นัดรับ (${nadrubDate})`;
  } else {
    shipText = "กรุณาเลือกวิธีรับสินค้า/จัดส่ง";
  }
  document.getElementById("cartSum").innerHTML = `รวมทั้งหมด: ${sum + shippingFee} บาท<br><span style="font-size:1rem;color:#7b36c2">${shipText}</span>`;
  document.getElementById("payTotal").innerHTML = `ยอดที่ต้องโอน: ${sum + shippingFee} บาท`;

  // Order summary
  document.getElementById("orderSummaryBox").value = cart.map(item=>{
    return `${item.name}${item.option?` (${item.option})`:""} x ${item.qty} = ${item.price*item.qty} บาท`;
  }).join('\n') + `\n${shipText}\nรวมทั้งหมด: ${sum + shippingFee} บาท`;
}

function updateQty(idx, val){
  let v = parseInt(val);
  if(isNaN(v)||v<1) v=1;
  cart[idx].qty = v;
  renderCart();
}
function removeCart(idx){
  cart.splice(idx,1);
  renderCart();
}
function copyOrderSummary(){
  const t = document.getElementById("orderSummaryBox");
  t.select(); t.setSelectionRange(0,9999);
  document.execCommand('copy');
}
function copyText(text){
  navigator.clipboard.writeText(text);
}

// Shipping logic
function setShipping(){
  const radioPost = document.querySelector("input[name='shipping'][value='post']");
  const radioNadrub = document.querySelector("input[name='shipping'][value='nadrub']");
  let nadrubDiv = document.getElementById('nadrubSelect');
  nadrubDate = "";
  if(radioPost.checked){
    shippingType = "post";
    nadrubDiv.style.display = "none";
  }
  else if(radioNadrub.checked){
    shippingType = "nadrub";
    nadrubDiv.style.display = "";
  }
  else{
    shippingType = "";
    nadrubDiv.style.display = "none";
  }
  renderCart();
}
function setShippingDropdown(){
  nadrubDate = document.getElementById("nadrubDropdown").value;
  renderCart();
}
</script>
